# AdvanceProfit-EA Configuration File
# Copy this to config.local.yaml and customize for your environment
# config.local.yaml is gitignored and won't be committed

# API Keys for Data Sources
data_sources:
  alpha_vantage:
    api_key: "your_key_here"
    enabled: false

  binance:
    api_key: "your_key_here"
    api_secret: "your_secret_here"
    enabled: false

  coinbase:
    api_key: "your_key_here"
    api_secret: "your_secret_here"
    enabled: false

  mt5:
    enabled: true
    login: null
    password: null
    server: null

# Model Configuration
model:
  path: "xgb_eurusd_h1.pkl"
  feature_count: 15  # H1(8) + H4(7) - normalized, no calendar features
  features:
    # H1 features (8): trend + momentum + volatility + regime
    - close_ema50_h1       # (close - ema50) / ema50
    - ema50_ema200_h1      # (ema50 - ema200) / close
    - rsi_h1               # RSI [0, 100]
    - atr_ratio_h1         # atr / close
    - adx_h1               # trend strength
    - squeeze_ratio_h1     # BB/KC ratio
    - choppiness_h1        # trend vs range [0, 100]
    - body_ratio_h1        # body / range [-1, 1]
    # H4 features (7): higher timeframe context
    - ema50_ema200_h4      # H4 trend direction
    - atr_ratio_h4         # H4 volatility
    - adx_h4               # H4 trend strength
    - squeeze_ratio_h4     # H4 regime
    - choppiness_h4        # H4 trend vs range
    - body_ratio_h4        # H4 candle character
    - range_pct_h4         # H4 per-bar volatility
  params:
    # Fixed conservative params from barrier sweep (proven edge)
    max_depth: 3
    learning_rate: 0.03
    n_estimators: 80
    subsample: 0.7
    colsample_bytree: 0.6
    min_child_weight: 40
    reg_alpha: 50.0
    reg_lambda: 50.0
    gamma: 0.8

# Training Configuration
training:
  # Data split ratios (must sum to 1.0)
  train_ratio: 0.6      # 60% for training
  val_ratio: 0.2        # 20% for validation (HPO + early stopping)
  # Remaining 20% is holdout (never touched until final evaluation)

  # Label thresholds for classification
  # Triple Barrier Method (recommended for profitable trading)
  use_triple_barrier: true      # Use TP/SL/Time barriers (overrides adaptive/fixed)
  tp_pips: 20.0                 # Profit target in pips (barrier sweep winner)
  sl_pips: 15.0                 # Stop loss in pips (gives 1.33:1 R/R)
  max_horizon_bars: 24          # Max bars to hold position (24h for H1 data)

  # Volatility-adjusted thresholds (legacy, disabled when triple_barrier=true)
  use_adaptive_labels: false    # Use volatility-adjusted thresholds
  atr_multiplier: 0.75          # Threshold = ATR * multiplier (0.75 is optimal for H1)
  adaptive_lookback: 24         # Hours to average ATR over (only if adaptive)
  min_threshold_pips: 3.0       # Minimum threshold in pips (spread floor)

  # Fixed thresholds (only used if both triple_barrier and adaptive are false)
  buy_threshold: 0.0005   # Return > 0.05% = Buy signal
  sell_threshold: -0.0005 # Return < -0.05% = Sell signal

  # Feature selection
  correlation_threshold: 0.85  # Drop features with Spearman correlation > 0.85

  # Leakage detection
  detect_leakage: true          # Run leakage detection tests
  abort_on_leakage: false       # Keep false for now - will enable after validating clean features

  # Probability calibration
  use_probability_calibration: false  # Disabled - isotonic creates degenerate mappings
  calibration_method: "isotonic"      # 'isotonic' or 'sigmoid' (isotonic better for trees)

  # Early stopping (only used when validation set provided)
  early_stopping_rounds: 20

  # Legacy - kept for backwards compatibility
  test_size: 0.3

# Hyperparameter Optimization (Optuna)
hpo:
  enabled: false         # Disabled — using fixed conservative params from barrier sweep
  trials: 50            # Number of HPO trials (unused while disabled)
  study_name: "xgb_hpo"
  storage: null         # Set to "sqlite:///hpo.db" to persist studies
  load_if_exists: false
  use_tscv: false       # Set true for TimeSeriesSplit within HPO
  n_splits: 3           # Number of TSCV splits if use_tscv=true

# FastAPI Server Configuration
api:
  host: "127.0.0.1"
  port: 8000
  reload: true
  workers: 1
  log_level: "info"

# Trading Configuration
trading:
  mode: "paper"  # paper or live
  symbol: "EURUSD"

  # Risk Management
  risk:
    risk_percent: 1.0
    max_daily_loss: 3.0
    max_daily_profit: 5.0
    max_simultaneous_trades: 3

  # ML Settings
  ml:
    use_predictions: true
    confidence_threshold: 0.40
    combine_with_technical: false  # true = ML + Technical, false = ML only

  # Position Management
  position:
    use_trailing_stop: true
    trailing_stop_pips: 30
    trailing_step_pips: 10
    use_breakeven: true
    breakeven_trigger_pips: 20
    breakeven_offset_pips: 5
    use_partial_close: true
    partial_close_percent: 50.0

  # Filters
  filters:
    use_time_filter: true
    start_hour: 8
    end_hour: 20
    use_volatility_filter: true
    min_atr: 0.0001
    use_trend_filter: true

  # Regime filter — only trade when both timeframes are trending (low choppiness)
  regime_filter:
    enabled: true
    # Choppiness percentile threshold: only trade when choppiness is below this
    # percentile of the training data. Lower = stricter (more trending required)
    chop_h1_percentile: 50   # Below median choppiness on H1
    chop_h4_percentile: 50   # Below median choppiness on H4

  # Circuit breaker — pause trading after consecutive losses or drawdown
  circuit_breaker:
    enabled: true
    max_consecutive_losses: 5     # Pause after N consecutive losing trades
    max_drawdown_pips: 100        # Pause after losing X pips from peak
    cooldown_bars: 48             # Stay out for N bars after triggering (48 = 2 days on H1)
    reset_on_win: true            # Reset consecutive loss counter on a win

# Data Collection
data_collection:
  symbol: "EURUSD"
  timeframe: "H1"  # D1, H4, H1, M15, etc.
  start_date: "2018-01-01"
  end_date: "2024-12-31"
  update_interval: "hourly"  # daily, hourly, etc.

# Backtesting
backtesting:
  initial_cash: 10000.0
  commission: 0.0001  # 0.01%
  slippage: 0.00005
  start_date: "2023-01-01"
  end_date: "2024-12-31"
  timeframe: "H1"
  confidence_threshold: 0.34  # Sell-only: min confidence for Sell predictions

# Experiment Tracking (MLflow)
mlflow:
  enabled: false  # Disabled by default, enable when needed
  tracking_uri: "http://localhost:5000"
  experiment_name: "trading_bot_experiments"
  artifact_location: "./experiments"

# Logging
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/trading_bot.log"
  console: true

# Notifications (optional)
notifications:
  telegram:
    enabled: false
    bot_token: "your_token_here"
    chat_id: "your_chat_id"
    send_trade_notifications: false
    send_error_notifications: true

  email:
    enabled: false
    smtp_server: "smtp.gmail.com"
    smtp_port: 587
    from_email: "your_email@gmail.com"
    password: "your_password"
    to_email: "your_email@gmail.com"

# Paths
paths:
  data_raw: "data/raw"
  data_processed: "data/processed"
  models: "models"
  logs: "logs"
  experiments: "experiments"
  notebooks: "notebooks"
  data_raw_file: "EURUSD_H1_clean.csv"
  data_processed_file: "EURUSD_H1_clean.csv"
